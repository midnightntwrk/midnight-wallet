package io.iohk.midnight.wallet.jnr

import cats.data.NonEmptyList
import io.iohk.midnight.wallet.jnr.LedgerV1.*
import munit.ScalaCheckSuite

@SuppressWarnings(Array("org.wartremover.warts.ToString", "org.wartremover.warts.OptionPartial"))
class LedgerApiSpec extends ScalaCheckSuite {

  override def munitIgnore: Boolean = scala.util.Properties.isMac

  private val validTx =
    "0200000000000002000000000000010000008772ba637e95f37cec57987be0b91f23c7bc97d9503b4d3d5603472f1d63524b35a7ec3dd6d97e56541a670b7f5b173d4b4fbbd7d35aa63612c00f9559a7d6f9e64df9b0ffc079b6a84f9ad5cd92486147e98ad3170f074b00000200f02d0000b3f1e3f646466fcf9755d1a1d18eeed0ea79e8af1e5af9825ae81609a6da05cc3a4f86b2662aaf96759ae5861d9d86faacb1d91e4630aa09d72a67a20a4e8e90e78d7c9b1900d47a01b8b367c7eed4ea7da858b3eec48ad1eece6a5e0d02d73a0e1ce4acd94d856f8703019ffa3ca31635ba46b6dd8d7aa9813c90acc8f33a8f1d94052571b1528bd097601553c521f00a2b16c8f833bf5ac754fe0e0442373f15eb075d5a0bc61e2b35acebc46b7bcb81352f99fa641217db5bf124230de6f2f38cd5dff91aebf2ca29dd5cae898042d2e86c9e1b961b5dd75f20b00860f24513a4c53169bfe66e2f7268476f70fe528310811ecb3f195c438bce08511699aff9e915391e062ea8f798a0613d99a7891164ac7d5769310c520cc0fac474b2526d3104b121c6139a5d658ffa9138e5bdffdc7581e5d6f5ffe9fc9e9e8370a220b79bbdbbc1bea0ea9f9a0e8412bcd063dd438a2cb64fcd9cfc58a75bd8847d65f5343d02f496892c0ce9e7aaa76ab04548fe3ad77c822e6257e6c07da11929374e5afc41b110b163ec6d7b4f157ea7b53c5b47b5b26ba5c8c1c8ba425b8901e53ad4f3ff8c9a7824accf272b25fd26c61e7b6d429efc8327c0a70709d2b27b23c0f20e4cbce671b428203d5b6af31449ee9c58804fc88c0beb4c20594027dba3fe9284f722f0db2c77f424ecdbef6b647298073717e3d917ceec69e0ad91110bf93e9fc44d2da3d8d879bbe5d3e2f07d03c13d25e622d219c67066ce2c78a92af8bf51a85f3b1b3ee6b4996ca2045049a898bf363831a4ea6d86279ce5b8a97fd5b677fafc7a2f6e7c0b534f4b94263a6dfab0ec18a483ce8f20e36bfe4385f6ef2fdad5a91d87483d06bb877b656e46d60fb06e0f11a40e0ac8e3c87e5c829f47526e35131677d8259a6e4229e49ebb25c02921e291554c3e4fd5203c33b34203dbf68d286bac7f3ee78268bf8cd70f2a53cfa7627cc0599a338cf0cb32050e416a74a4b3f9f2f77986f84d2a709654d45443d210f971123f0c54255fc65ec884f8356212fb238e11ff33d702059f96de81f30017e57feef0661aeb8fe0813b9188468198544784d7ea1f14c9d9bd08f004b394e1b23a484c4d8d8c43c622d9c8b238a1561ccf5a3a826af9b70a28370bf3572fa467f1427f0aeaa669bcccb9a49d42526b279655c0470705cba4c28e7880afb8181375c34b4cd5afb008ac9cf71995b48f05997e89b26119b750ff29634b10e5d5d7159279137e011b1b3f174ed73b20899350e20fc3a41624cee44325f213b6acca0274570ff8ddc3d7d46447573e987b45e28b66c7626bbae70a0ccd75f3b7d1034d15f1f8ad1dd1316641e97fa80fdc65d719fdedee928f0c007a7a09b65203347bc84c8e3db1c75e8c126a6c3d9a56a58d15064cb008fb8cfe4563c8d503456d32de69b817ef4cb95d4466f706c59aa82d907090b570566e64a9083337b2f02192485dc43c77f8babc30e0a8d6640f904a578e90fc214b4d55f22d0fc43ddcc5fd007d4aa0a90e244e477a1bbbdb6620b3002ae5b20dda81991710ba81053fbb9a28a5e4d8084dfff15507e3600c952299c1712e6d3ba6092bc96d62b5dea00616994cb7dcc0d12f0ccb3f5cd50767a9f365c10d6b3a3a39664ecc80ec72a5bd3a59eb3bc8f9df32a89c7672e5070f890e5abf17d2381f42920d80f30c8887c1175e46b9d9e6423f031183d6c2235355c9a9b4a1981988fade5920c51c2ee861b381017c2b559a96ec2d549079f5bbaf3f8146f02ab084a3e9237a559f991ed07dca85c595f4712d24949c0998a9691fae1fd5cac6d7163a69546ef28835ec4fbe031d2843ab579fd09c0c7b00b2d6e9e1c8d71af946475cbe50ea33c29fe1062c4c980f0c1ad018f962b7636bdc0242002901bfbc02b688e5b6c1d6df5afc23b1f98e913e50b2af19dcb8a7a5b6c1e5f7df0376df3032cfb5ca348b22c982aa566066d3fd27f7497e71abb4200e1ff0dbbefeca226bec4d58de098c33b3a2d4d47a0a86e9e503860e438fbde572281d860aa0292aab3aba9f14876bc8c0b3a9c0ed762d3755695efcb83dbb170e10ada4798b2a9c535cf3714705e7a8d5cdc55f45c2dca6320337d9cb0d310e28897c680f0e0cc96a4cb19d225bc1728d54f996649462d4eea0cd3a563886f5bd77ea6e0ffc80a33d976fdd5b06c89e9cd07126246fb0c6440ccd0355e604ab2fba5127d1fdba2974aec7d9c51bab98cf8579a4a188f36b87485efe4c1ff39371582884083a6763ca404c7aa7b647c3c3ba541c0da4b4de75b09c5c43b16632c8c8da28f58727e10ab17df9061fcc7704e06a3657ab0216d4195c8ddbfe5235b8acf2411c9cb57a271508220f29da8755c71d1d11bd467498274cfc532ed69da696d27112f8acaa746d1db96f42fdc95df4a2db5447355bc00f22969e32bd2d48ae1d2601107699f0d9d6c89895b620d2d12a72253ab79cafac27ea1be42f7576ab716968069e13e76c0cc3b963b481f560a37f3f5558404be0007155f42ab17585ac37a80db5c94793271b95581d17bb30fe21028c05f6f0766ec3eb8eaa87be2274ddc3d5d14ace909551942c48772d56cee6553a7e3455d4ce5a8a7f9c218a67501efc926e891758a7d5e4509dd84ddae7befb809e29279d35b2debb0820040bcc33984ad2ded8c7df0e492f948621d4cfe173e527717d6d74ae97c6a5bf20af3f94646b356ab9bf285c2abb22acc748e3ffadafcb4a0f1dad5f6d9fcda6b8dd04b506b7f92a16523019c15f7f4376d7de86a7d9a2b39fe41b3e57c8be9a353f25a8a7b74ba1749bb1d2befa44b4a960eba414ea542e3c7ba29f0410960eb2bd1154decb69f70e7728ecc4d7002474130a6238cd719ab1ffb68faa6f674957cf07ae35ae475a5339fb6ae8d0dabb0b4119861c29b3bf500022ba518d656e8c51323a8d60e0b0c99acdce4a46d115f834ff75c7dafe3202aae0d4a0d64695a21b3a1bf16b4e19db77b013566598a91dfc2a5f9065368e84a26180d0625239eca2603d908335778838fe9817958bbcf302abcceaa3e7c25ccf0841fc2cabb84423f5fb141419960522ea127ce333e94e5b93224e904277b8b90116fc4c420ed8055633f53219a44a879f3dea7cc23d75e061d2b307d2f99423385348f08cf7710e4093f65e7ba4458832266b8b98329624db19e22b017b01597f061f604977fd766793484b18b8fd30e3ebdb335b0b400dd64f5371f08c814721a2fbabc05db072f9ecf7313ebc6b94c3bfa6e219002fff18a1ce79c3bbe934ff0939ee7d459aa703250a75660055f7934d5ac5d0342fb52f4c719cab9db7c753c5eb5679a316f54b6257a62d4691eba3563dfa27a99b6c6505cf378d9211d4f7213f8ce05ac588ee86615f730e4ce846bb6e41bd324809658b6b442f7a3d1d20e454441c0eeb4b1f5a2b4a39b62b5309ed673e5f1888e22560ab9a4f961efd04f91a3919d7c079890122868fd309e7d2abdbe0cbabb601aebd190ca8b1693acb735205bda35facffbbc50db4f25c33e0344ae5fd3d38290b9907ebd632411b1921bc5a481fc021509a4eb41f44fd22f6bc3d64818afcdff5877d2b54f9226ed1d72d7e46911f8908efac6958a3747ed8fb0be8f238b994539b1176e060b0ee5b963e7792c5a7cf363fbe0b8a5cf906f800ef37e31e9f85a4a41763976b4e6b9ddbe7cf2dc33d6e44431f2330dbea53e0b371ec1a2332720a0b8c3f452f7b69ccbe3689214bb3d723105894b83f1192f8a1f45b32e7fe9a1d725db1a44548381eb70cc36a1fbc3a26b67fc1df3130d37df268d5dc4668ef368cd147be10fc4699227820afaceb8f7ea8d2b26c1e519c31622c4b57f5548333690594fde7790696cc7d57aee3de3caee12d8bad3e21df28faacdb2a22e1b28426e62275fa0cc4cb84bea97638189f40729720d95cda875aab108954fcfb6f7dff72412d95e6a300c5b90124b3f2202e7a184f5ca58337ab993ee3ad7fb42be07609e4c96eaaeaaffa5d7dbadbda18e905234b2876ab3659d49be1a800df976995fe1dbaa9dd889ca6042d39cacfc39a9c04d077fdb7dfb3d92c936fc96c8813765ef0bf28ec3b8c421aaf21922dd01e2b95770157e4bb4545d8ef1050b11bd01d53e4b8293444a52396b18dcb10fd3757337440bb745891a87d61619319584baf01b3807c0b26d935e31dac8e42dd0340d62e8e96ed77f0c59a458594a505080d3cbe47982113120b0e1a9932a2d215ee3f9fd5f60892e5100e70914e141ced70fb907805c61d7db43436a57e8f2c55a8b455a934cfd9f3735bd50c614a2d5e2e9447f5e5d1ef26a7210bab378f23dba501fca4bb4d211352e98527db642092888bb4c8d52a50fbf36ed9d95e340458d2aa96954ef94c40ca0ac365f9b9269b4c9a624cd51b2524401101fe3893b3034d84f273f231a6948865f6bebe23549072218907e1be272fdc6a735615899084004d72c4f0ab31308be2773180a7939bba20feb2cd42596c316833cd657bd918015632c5d47d669446b8d0a0ab2389e5e90de8aedf67703579cfb41a00a3ada70cee6f92fd7982335a1a9e91b816f644a3612f10f6ccfd3d5547250d272d7876b5e09a66ae81717169f69ffd27207cede77d8cc6707e95f71e5dd9dbed100c9dc7107b6eee2f0786f2db98f1e2cb629a1f5874402f11239afb54152a2b40a7d37fa49242aa3584d7db25bed7ad5246c82ef429e0450b3fc94a1a9be4b5391afa904818f65c6ed849492c718ab9e88586168d4ca20baa3fd264edb5118b9255a63591d0e6d2973b6295a36e429c9a80c753218ee221aeac5123f70d3ed1592102e96139c09878bcbc8d072f23eaba179c05b27bc59f5d3864f4598451ddecd81cfdef59bc56aa23a0211ac823494946ca3e419e26a89611ca6b4dcee4eb6210529cfb63751caeec15901337c11803895d18d683c7a8d0e3be0e4fdd95377178bf1f1229982071185312b8b6366dc39db812cc9438f6dd3d54e047b738529387322d131e327c3e6c192c1dd4417ccd89a56155f16b265638535a021c90ea6cc4d33aeb04c95b94b806367908fb486f6c8c45c29a03246ce3afe16e7b18a4af5b4cb515dd9857fa6450f53dc813f07778c524209cbd2ea864558189515b2aeff36dd4302742b7484d598532c5e5f7aa5734a05365482aa41353fa1cfed18bbc115b89c196d7ea45c6afc017d431eb8d61345c1c4459fe49142dcb29204e9d02e3aa4fc8847be35430936a9a0ab37f71fe0c0f2331e9967ea062d7d3ba2f772259c8251f86c5e62821c33d5ad5e1bac0155e63fc2fed8e689fb347f14b6b9f5b8ff51411fafce32888e3aaf1a6e72785ecdb6de144099253a821c421bd21a5f02dcb3234dc8c21699b87d585fca988b0543d0183b0afcad45dc3b67ae335f76c73f52d70fbf3cef3e9e047039ba93d59372a8520819ccd6ba3cc61f5521ecbac31760d187b4e69f1d039ef7a53078bd0b3080c4755be4b097463db70e17f8b6d9d54b40034718ac7ba9fd71d181a3556d483e76f92957dd0ed2535bae34edf02c46f8b8f35e423fbbdd6d27c16f8507dec0479aac846899e1c5f7b985736a811708148008cf12e2146949fdc3a456ebfc184f62cc49247f729ee449ffec68f71acd1b2e42c41dd269d1a85dbbac5edbe8b3ec58c5a403b0fdc1d7501e82356cfe6eecfc822a6508717b9f32f0a5cb78dd5ff7f2d5ba38b0a874cb997da9728f25d3f3863b0b2f2ed8a34491fccb07473af6d671f83d34cde8d0fd2c6e2498251184002bd76bcb407086693046ea858c225807ea25c32b0aa3c824de4731f481b869ff124e5b001ad703b560333fe2aa5fbca5c0bf2d81ffa2173a0b717965f0466b8819645fa1c9e1c882ec85edbbfea7183c4bf8844cb48411c8925b12756be9ad1881cf134c1643f3435f7e557e1a49b1a907c5b7025885315a8a03ea9e242ae5eef979b885e3e2aac792877d9bcaff5ed1e2d69bb96d1f779eb0ad2018990bc9106bc0a5f3625a96a84448de338ec9f31460459a9cf03ac81bd0c4fc52e7bf5420e6d236007f08df73cfb6ac1905734136b10aad2685bd4ebeb0f5a691ad6eb38ed10f4cd7c62d4633ab6c5a4f99b6da29590f160411f8a718e432f303566177a23771edfe626d08d8e104a4186284497c99acaeb7e175d9ee200639dc0dbaf2b8d95756a2ab44d3d36773e9fc79ed5e67af17b34e7a9896e111fab5c3d3d5f8dfd0133cc6d8041024cda60ddf4eb6cc496767b396ca59048ceb8d9733cdacf3b771d904a3e190e8731a1af5a3e5549b4e626f574d2e4b58dd817742f6d6228d41568ce679e5442c6b6ee30aaf47810d946c472914e18602732f52b0025307028728144f180967ef64eebe98cbb64c40fbc1ff562748e304bd15277c32a3d193df3c991abd5d30f620ab8896e89ee04ede350fab2be76e84bacb78c9bf68d33857d5ec61e14942094421f4eb22ca42af73f7f070928324a43b7c6a2830f0adbd570ca6c89e61be12f65e87f6980e2e4b4565637eee04101445c03757232e36b3d860432dc0825bc133a6d4d54de070732d5cb0e571f5af1f8832c59c08708d784db98e6f7a45e7d35f023ce8de75670f8f56dff3b5aa6d12bec1ade722c14dd7d4aec219e1275ad2eead339b1dc24e3df74d0829e967e79daecbc372103c3e6926f408bdf87e865ecef5ba657a76b06d6cb2124b16f287308caaa6dcd11b69b9ed56dea063f1217265824f46c46e1628901b5c70894637c0de77d53f692c9754c25ec60c6d574b34f4b090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c801e1d5c4dce68d991a325f92e067d35d3eb28fcfbe8e47010d87522ab2bcc16cc5e185bd59bc105ed7a9cf4ba72b1da71087ed304be30b33e000e5baee89641264c569393859986fdf7f1c669b6288aa693464a44263845ce48e0630bccc093714472004e943a30e738670b123c7174c5810521eb5098e31ae08f32290d3c08b1f316b5158fc77052dbbe252e4548fcef68cd1234d4dad789b383180a272980c27be40a03307041e1ac0f152f4ff8067d56e7836d693be4a4ecfa894ad95ea374b94eb825c8b017fbf78550536d6185d9f1a1db7228efe758f95b8c196a71e50c85bb139d77125d96f90ed2d027279089c89f92fcd4d7bb51f44551bf94ffb73af3bee7b57b1fd5f6319a693e722996d3b8dc24d3ac70fc04b3da45299f9183925b0f6374bf581fe7efe5cd371b6c66d2c08c4e7ff7bf387074fe0574cdf72d46f3b7011606c584f66a70d5a3c8921ca920d60595583acb34a1c0126127ff4ebf303a71cfb16e03f0166e8dc5c95a0dd8b59956efe6bb75e4d54fe6093ffce9c21fb42c16f36008bd8eb78d7258a04008f2fdecb2973f0810f8cf712bb367f810fa1e4fb7d73e63bbd43c0e5fabd3d804bd22d2daa72c0eb9d22a56205a612de5c7dfa0a541292c03668ab736d359bd003623fa34183bc78edbf4a05fac4d7633da3dc812263fdc4d12266ea579a327134db8b5267fd0f408320862fe2e42e186a14eb30d089a276a762fabdd92db0bc8d5bc181605e72d06300bd5d8597b368eea76479387494e39bf6d65f48171755c9fa976113d110616d60f09b9b7a3f91d52129daf341dc17d0f2ea47d4e5051cdd0f1a53dc9a8424673eb15ede175af20f11b50e21df0c482b86c9511e836efc70bed4d612b3a9548bf031c6a52183b43c7ceb4217a8f8df20c31a8161d73f55d82fdcd250e242c3c76dbd1def891f54c4893aa81ceda34d1f500a5cda02fa772837f351c3db3f9cfc5c7f342d3dfd6ead07ba11aacd6e3a04e59fb4e6277f60ae14f374fcc91500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000262e9fe9340c5fd68c40f4467c10a80e35c48e5f1964bccdcbe7a60b17edbf36852de16cb69230bfac51eedeed743e3ae7a6f6021ebd310499be5f2240c5556a3be2b5185dfca248e1e3be646afcfc7ea280e6e2447e19520a99eed3dc46c96822799bd384631c6166c1a6afb5aab00d9acbea149eb62fb25a4fd3dbf0a56497c4d1b10ef367a1533bee4bdafa2803ff4a502c37fea685219cbbe166092194d8f70016b1b921e1f4e352fd2b56312d0b8579bf5d497ca9a005ca2e4c83f53874b9050ff7029523f17ffd9c67e489cb6438f1fd17bedc1a8cfbb2f7695d17110ed2c8a28272cfaa3a4205eeb1b4f70ceaa64daef19056094f251c0c3d082e15a2b3c512a5e8bfded1953e12208fdfd23645aa275c19faa12d9acbea149eb62fb25a4fd3dbf0a56497c4d1b10ef367a1533bee4bdafa2803ff4a502c37fea685219cbbe166092194d8f70016b1b921e1f4e352fd2b56312d0b8579bf5d497ca9a005ca2e4c83f53874b9050ff7029523f17ffd9c67e489cb6438f1fd17bedc1a8cfbb2f7695d17110ed2c8a28272cfaa3a4205eeb1b4f70ceaa64daef19056094f251c0c3d082e15a2b3c512a5e8bfded1953e12208fdfd23645aa275c19faa12fb9de1145bebafdd00eb89dae3bc269f3a6232eef1b3572bc3f79fd510a163cf6a3a4c5a7573288e90a0259ab54f15e31395b5cdd484e801701d77dac23ece06e6f46f437043d3791c0bdf90cb31f2d74fcb735e29c63b2cc7b648027ace9f3e83fe308fce08fe0882e034af71ea06206077ccf914938bd14f791b7488512d5232e0f6294633438c08de2fc63a0109a13230dbd0fa0d01ab6d6e87eca04403cc90003875e10fd90f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005dae5d9e87a8b423978bf7a156945000c977736140b85313eb361ee4c89cef0a58c20aa7ab5027c2f89dbf85b63111b4b816ede76214951eb3ca621c57203315d30359237c0334581e113af2e096ef9223a0411ad6cd7a04779a3e2212e86841f7dbf4ce88073e17548df5f06610b614f60521ee7b443bb11c8611f52779b79e7cf86eb3723e8caa65b65f5689f44d794a0e53fdd2e4b6b6557ad04431fecf7142d9c59c4e0314130000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000032de2eda8e6d820a539fa3cead8b32f9763a5b1e353464a31185b1219f00d04e804c0a26ca25d8199045e2385de22839a3a3b22e01e778111afcb0f1ab22371c304ea51da24af1e67c42e1f23c1f114c90c3e933fcea76eed568d8110924b2c6bc7c430a41a4ba52576b8e47d6ec5813ab4f2ee0b093c4c9c8c1b0eaa82f3d6e4f748db91a61377bd49306ace249c6abbcd4fa32b01f5230aaefcc2a6875d4200d9f01d81b53fd1932de2eda8e6d820a539fa3cead8b32f9763a5b1e353464a31185b1219f00d04e804c0a26ca25d8199045e2385de22839a3a3b22e01e77811ab4f2ee0b093c4c9c8c1b0eaa82f3d6e4f748db91a61377bd49306ace249c6abbcd4fa32b01f5230aaefcc2a6875d4200d9f01d81b53fd19644e07720ee9547598db7fbfdb74f3cc4e45afb9f206b07254e407223900696727324d7953bf2f9f3a0bd3863bed3ed1cfd33a8f3ab5591f624ff604698220faca23f98ddf25e8df77fcf6bc795b9d825f35a54fca5f9bebd1c28930c8852405314fb304839f0da4307c4ac711bb8a163c34dd5dcde6711364bf119a4127be538ff37d8de8c6c1431cf36455ebb58393ad2bcb138c9b8c61347691e36b93c1a0d5ca34ca9217d71730783cbc9e2e4a2da3bfd4a7989f7ed52929e8738e1412f576a393a069340c3c155a61f67bd3054456f508e61f230bcc1d78b1bc2834731ca42be4e600769702d2a2cbfbad22159307128291e8f8a5ad24fa76186414055f467b65ce81df18cd4f940591758e353c3d4779df1c1fad238df4fa4015b508902db0eb04e3e419b700f619f38f6f42674fe48c0790a2feae755d016de0cb9012ecc27315d5ff1e64462c78bb2c03e908920f8d668236b2b9cbf8451b2528ba8ffaee185d87dc78e4b29f858746decf55fe58f39942450e8e6860115815a0baa21ff5f908957dfe18bb09c29d032df97900ab0dc6bec5a63889205b3c54c38e6b7e7e4cb53d6355574618dba0c1097cabc23453f34073dd38b3ae2b7ab5b650004eb7972473426c1373bb53cd930e7a489bba67034aaaf76ba67ee12a33b8a9e67395d37784f552b0df3e4b3e2cb7c8c51d3c222cfc705e1e0cf7192cb7aa975f4664886589bf23457f5650210c122d8886417197550150ae3fc862fcd56b98988e3a949a3ed1138244556a0960021b1d17d1dd8245e13c133bfa2374af45062aed0a4a6d9374329ee1d0dc41f74299b3a400cee15504433caa7956ef3dac87eb587d5a65186b8d14b24b0ef16f8935aafdf133376d7fde928043c2647f1db6e209c46595f3156c478728896fafb49b1a53e7c3cd78c9ae718921d0b97a430e07ccb75c0cbcd639badcdaf5c67311f20751a3348595010fd80b9f270da00835c1fa516c1aee8e7016c15e26d635c1019b0483bb89168ad60842db4a8c54d00e4d6a42234327a8977583cbe1cda0655e562985d2f30032146e6449c87bfbfb80234d02fda36ddae993d5edf27d8d6ca60a3e3e99bcdabf4f041e5b03d6dd27ccc2ee03f3959a6b0079c7e7266ce3c99e580d7922fe3c9e77712e55a18eeea3463f0afeb03f9766d3036122a319582f513e47a01734b0caef2989ed22de760eec5d50a52e052bb91cc71e74f403448e78435dc5a05ab8628d24abc27df709241d2189370b851d61b0cad9633bfa5985c79b02e1c525dd6551f35209d7a7b36b3bfa8d222d50357c697c2b3423d17d6e71e006afe202f4fdb3102902a445f405fc5550860a91ceea42aacf6a0c46d19c3c97dc3a34789165972c01c3c8c17305e43ffbf636f00b9616cf0979cc14956bbe0e5f5b093f684907d719d4d48a7e5c753226fade7119c000ac803e7c306b17d691469f5b5de4795899a2247743886d7ec401ac8623925b560b2cd9c923d0620b052c36e2ca257dd074e6fe1510fbf68b8478121cabfbe0765e2035d87cfd799a378eb8b5b589541569545757875f04250960e71fbfec33537699b0cbec260bd94e29638409b7b1df10e56abee76ef972e20109a8b1d72e4854e5d02dacc7c77adc63b41fbdf4c2dd081be4a6753ce0914841dbcb95d2e80ac0673d9aa7e60b4c66e507e7ed888624346a7c4cea53010e3176d865854aed47a41ff49ea267a6a30ff83aa477c65b37a9238496acfca4f6976b39c48aaf8aa4b645e9e4268492554fe3613c5e893841d01d68d3644ad58d465000363ab1406d21aa233a1c5e32e83ab5c352773bd7e65a40b1a6f6c7446be4007d2d17db1e982cf2265199333f8501e87e2aba874b74f57077e58002543c09d81e1697470e3131dfc40094c19257ea2e4d740e4c839479284d801ec255864c980c0a3b32ed975d0398c3d503b3aaba0a8408606ef680113ad936b814ffd662b8bc96e1887d20e49e87a72f2866dd62a79d0642eba207b43d63fc675a1e81762405f3ab447643c806eee736730bd521dc9170687d241f8398e5b7368d6c2b9d43042291daee16100b8116d6ff944806b5d552772771271b45157b4dbf6ee85e8604f58f019456006f222fe213a1b0b091e63c4b0c8b54f666335c6947b5cf2b8b6a1a803b3edc108fd1a436294886daa28119e526d3e1f7eb2e8bc2afe7a21b9397c99ce63fed521573b1affd836a9421c2f68d87ebce574d5cc4758d43f1d73feae72f4b7e0beee091a6b805c3789e1fc0dacf0600e40738ad9658e302374bd8848e6b8e79392d250c77a44f4508999faeea0dfecd8ddf8873e659c150ed805e18f06073a7012daf0dcc924363521422592a649d499689611f359dfaa3070a638bf163985d03eba11264462f1596534d5a9085fc25310bc802bc44012780a9cf78ed8467f3e0192f614d9d24d5a11c189d059896f65b9e7ccc18004fd9911154045576bfdeb94524609145e3484b96922e5ad6b8056c672ab0c6b016a8fe1a7d6dd33445d5940d697d1cab5233f064ed57a7e1c4a8250bc17b8aa355da092c990278997449cf9554d6e84a2f5784a84217c9591f996a1a9e2df9df06c7fb2e6874ff6a9725fa88eec797ed1052da4c55b070d1d685b5cd511378eb2e3a7504332369b08fdc66f7d86cd89124257514607d348ad7ea5a7b1bac04a943b53d647f28b950f020d4bd472a53a19c5b09f09b60de44dbee2c258e82c99b795e46d865489b3073925102537c8957781645db24486fd27a64bfe9bb05ff20d2ab24d4ba879fe2f4fd139d97b29d29fdffa9a772f49e45fba75692c1bd921c1b6ce908147dfd2a3c712cd99b8676139517b0301677dbbb6ee00d837864ac2ab9bf881029a9494b21bc098911124e5f52bb7dd0d20ade0a271d2a200e9d4a1f3391e2a8a445551ef4c2ccaa6bd3c7b17a7aa493e49fb2c1a19a21817fbe6833c28fa4672cde6535bfed12c7f1a5cca09d8d1a0ef7d4b33d929f0d7758a027ea05e02e72b6f2b78c213d59b9a81f3315f0104d0a383692b527c52c24b83f6dcb891aa651f865a011bb4e460b2d0d953c539646f9d235586052bafad8a45012f17575ad3e97a825eece475933422525bce22e2a467fcfceaaca8c03009d52b015e2db6619eb39ce29b53d013d9dde85fa966f6fdad75954867a22ca4d2794e0ecd54cb2fbe1b054b6019165bfa2f375715b0df2d7c7242ec2eea0dd044e662ab7e76c8c8b2e4da57f4b47c1bb7b05ab5999eb38b360e95b57919fae4d403b4f4828d55525d6a3231abb82ebdd3d6910069938cb139d3c2cfef746606807269dbeccc3f645120b2e8c1e74bb172bfc070e1072d0df69b47299ca0272cea5424f90d73a1bb51b09b2ff2cefa5116dcd03560c7a21e9256cda92d3d609560bf08aac5fdda15f2579e932d615a09d2870b850df5315efe41889dd2d243706b319e6b77dd5920585d45f4787e4117d0dfc2ff8ea4fa87c6b59c7c83f021a978ec989c8e01e88e0ed4719ef568d995364f601d01bd7207ed2ee4e7d26bd9413bdab908b3880c2413266765c784c2309055d274aad053d698f4eaea84f4e4721706b7d061bbee05bc49ba563686ff7c8bb3a57d21414a21e625c9c9f6190072acf7a32f2a62cb134cae2e58bafbbec60b1450cb3d7660b66ea0e89158c08ee0bfdd53677b06dc9134072591ba6eecb17aee7460f64307ae0f7db0a77d9d6d1fcbb8112ee7f1986c52958b29334bb45b4189d7b6d1d5d8d067550157f5d4a7f994a2c7d52293b0c0ed7a6373a378b7c57a70ec83a01733131b885619c41b5688337575b6d15409f4a57799c357a5c0d7c210ab3823a2a16333d1590205dc6f213ed79845949015af672c9d6e0cc0cb8f53bd508245876bad19f37d6f3883ded4177ed80f2da75dd33bb55cf715351611246b878b155794e03c0ac00beb8924d0f578e33c6e31820bd81d9b5d02850fb9689479fcf806fadfba761561eff121b2f8da5a9a7b3d59babab1b80143e457410e44075088c1aab52321f50cf8106a4758bb74c6f2d55ec7456c56e96e9f59d157034964243b9faeabcdeab013f89a88daf6b15bc1d2958044891b8da7e9ef44126c30049895ad3ddee1a1f21e16015d9867cf369b46310bedc92aad81dbac8646d834c4b5ffea13e4dcfaf999470bb048d47210a7fe72de1906409bad02b8b0ac8e42f0301e724983bc5d3d17c472d60966928615b5e2b2ca24aabe77cf721485638243bbaedec0668b5b5c3ad3762f66e042e9d434b85be36ed2aafbedc4b6575d581d1bb92339889b8f1ac52e324eca67d55814adf8665a6e3c1bb1104a60a7507f45eca676e08c4d20e7ccc2e004cd71d9a5d9f0691c8e72a2be1631b877dc2e82b1ad9ef64f762047037bc2b8a39e49f6ba2919db22124947a9364d3f972ceee2f6ffacc3438e682ae5c83990400503f9df5a4d620255faeae21250c0b9af6286f430084299a8e0e0b56e592dd1a955e1535a121b6adae621caa53971ca815f1db0b41cd5eab531593f05a3d6ec2fd77f5ac52a5171612a04e65dd31dd2fef6956770ac1da02560ef269323024ea2b33b2f63f5141e6c64e4d83681921f293e81fafcc0ea2393a60479345afc1ff9093bb8fd94fbde8cbba9528bf3fc40cce714e454efd278b911ca5dc8c74fd7e7bd29290339a5e7d74e30253e32a96bc771a3961ca7e5fc42387d4c34a57b2beeb96264e368b071b5d0b65c36d0192cc0e30b28339156d05fbd11f4592101c92c3c2acd74222cbe8ef3b3e423114fdbf82ca3092dea85bae0c5a2e393305971a718fffce44d4c3ea16315db9fbd6349a3e787b493b2168b219c2d3b93c53b398b9039ea7f7f3776b8e17cd4554744cc6ff8fb6d154a15f07748c4b1ed1dd77485b110cf73fbf9f8a9be5bab7459e5d8f569a344f46e2abeb005c13a860a1bb6ade4c77eebb39a99ed300007bf852b70c60d3be46c2fb2b6e4afb51fd7394d1d641d2fecdf3ab7454c707f41b8f879fd1cbb60b86252687413f08754a7b1f866390dcfc502bf4af1478e01d9758e77d4eb01940c21ea38cb41867069eea7b8532a6b0840cfca562a03fe1f0427581d6af94aa122f40ff6817a5c8929aec15812399f6cd9f303d5f9b6614cd1e82f08f274f5c8575dc1bc550ed863caead0ff52ca1baaa87aaa23d9a1cb3ed410550edccbbce2c1d3f6d6b21113da841ff6459074176ccd6a91463250b93fb7ae8a358b1a9dda6f058359f3032a0dcc76abadd3dcce8a273714f12eb844dbf7c4af7c61a74fa97c9c1e5d4501a5384ca04d0b6a7003c018128d9c771d4cb49099b663263f7ee11865bc15599a4939f042ae0b45d4de679dba658cc0191df444a2abb98b86929a5087ea1f46dc51b5fde3b6deec3b761b9b2e8d40c63525428a6e054dbae88b43db496c36241ec338b440e36670be68c385a976acc1910256068a1ddb203037288181b787df8af3c03b4968279f3316e5c801b2fd2d6c966cb465f29353a8dca30495487731d349132592b5b674d16e0273b58b1368c4abc2106149245f951b9e34322915b833cacfffdf7b0c00b2302f9c9a533326688eb622df500e10f60de67378f48b6cb1b66e2f8283e8124c6e7b9700e148653a33df450cbc3e97e725750f26c8330ea65f14bbe9415a4c7bdbd8017c1e60b059d3330de0bc32a267550a71b1edaac24740216fc3c1fb3389621834d55e439e3f21b26bac8ee5986609b198ce989ad9f8917645eed24ff0955a4aa1e1cb09c7dbc8a0a6f26d482edec08378b6a3c4736b27205898d380eaf9b9d95acc570c4dc882ee8a4cf58847b5c0b1e347a05f506cca292b61497a00493e942df9c45e692ab4936dacd18b4d481a971a2804a0abbbf01c57704e63877d4f3e874ad1bc391be6396a9aa7f841131d3e75ee4c908f806b369123df6561fa8a25137cedf857d75d6002917434a6bce2b08458030b913b13d1a061b50c8b948b2d5a10e0a67108f16491ab7a33d2688fc05c4458c449b8dac8f3556e2a8c99dac4f055df0f4d37146200cb6db1dc5abdffc38e94501a3705614093094ea4d03799366544d5175bbd5eb49181d92807a991ebbb7bd87a17c7fab2480f3894524d09530e6efc6742a7ba24206787f234c01c426d948da4a00000000010000000100000000000000000000000000000000000000000000000000000000000000000000f0d8ffffffffffffffffffffffffffff0000385b6e13040c02fcf6c8742e2be620b3fa876545d57f7dfbde3f68ad434ce545ab581aa564fc9f3a8b58938751596f04fad5dfb5af5bdbe50f"

  private val hexedEncryptionSecretKey =
    "02000038b28a2914ec146b7389bd0c2a0fb1de14328935441aae2126713ee6582196da80676b1bd3a9f825e3f80446e2ab96395aee226c344f801e1a"

  private val localState =
    "0200000100005fdc889d8f96380e90b2b0faeeebad1bc5694e31e40f633c307164c1dc08e8fc02000038edfd5a6f90b97dc0aba1825e900561487cf68715c6cde9011969ca07bdfddb5732056acae764cba81ea8ca6b6d0f2e17f1cff013dd841f1801000000000000000000000000010000000000000000000000000100000000000000000000000001010001000000000000000000000001200000000000000000"

  private lazy val ledger =
    LedgerLoader
      .loadLedger(networkId = Some(NetworkId.Undeployed), ProtocolVersion.V1)
      .getOrElse(fail("Invalid ledger state"))

  private def failWithErrors(errors: NonEmptyList[JNRError]): Nothing = {
    fail(errors.map(_.toString).toList.mkString("\n"))
  }

  test("Creation of MerkleTreeCollapsedUpdate should work") {
    val state = ledger.zswapChainStateNew().toOption.get.data
    val collapsedUpdateEither = ledger.merkleTreeCollapsedUpdateNew(state, 0, 1)

    collapsedUpdateEither match {
      case Left(errors) =>
        errors.toList.contains(LedgerErrorResult(LedgerError.MerkleTreeCollapsedUpdateNewError))
      case Right(StringResult(collapsedUpdate)) =>
        assert(collapsedUpdate.nonEmpty)
    }
  }

  test("Create new state, extract guaranteed coins from tx and apply to state should work") {
    for {
      state <- ledger.zswapChainStateNew().toOption
      guaranteedCoins <- ledger.extractGuaranteedCoinsFromTransaction(validTx).toOption
      updatedState <- ledger.zswapChainStateTryApply(state.data, guaranteedCoins.data).toOption
    } yield assert(updatedState.data.nonEmpty)
  }

  test("Extracting merkle tree root should work") {
    val state = ledger.zswapChainStateNew().toOption.get.data
    val root = ledger.zswapChainStateMerkleTreeRoot(state).toOption.get

    assertEquals(root.data, "00")
  }

  test("Extracting guaranteed coins from transaction should work") {
    assert(ledger.extractGuaranteedCoinsFromTransaction(validTx).isRight)
  }

  test("Extracting fallible coins from transaction should work") {
    ledger.extractFallibleCoinsFromTransaction(validTx) match {
      case Left(errors)                  => failWithErrors(errors)
      case Right(maybeFallibleCoinsData) => assert(true)
    }
  }

  test("ZswapChainState creation and getting first free index should work") {
    ledger.zswapChainStateNew() match {
      case Left(errors) => failWithErrors(errors)
      case Right(StringResult(state)) =>
        ledger.zswapChainStateFirstFree(state) match {
          case Left(errors)                        => failWithErrors(errors)
          case Right(NumberResult(firstFreeIndex)) => assert(firstFreeIndex >= 0)
        }
    }
  }

  test("Validating valid viewing key should succeed") {
    ledger.tryDeserializeEncryptionKey(hexedEncryptionSecretKey) match {
      case Left(errors)             => failWithErrors(errors)
      case Right(StringResult(key)) => assert(key.nonEmpty)
    }
  }

  test("Validating invalid viewing key should fail") {
    ledger.tryDeserializeEncryptionKey("wrong") match {
      case Left(errors) =>
        assert(errors.toList.contains(LedgerErrorResult(LedgerError.EncryptionSecretKeyError)))
      case Right(_) =>
        fail("Invalid viewing key returned valid")
    }
  }

  test("Checking relevance without correct encryption key should give proper error") {
    ledger.isTransactionRelevant(validTx, "invalid_secret_key") match {
      case Left(errors) =>
        assert(errors.toList.contains(LedgerErrorResult(LedgerError.EncryptionSecretKeyError)))
      case Right(BooleanResult(isRelevant)) =>
        fail("Should not be here!")
    }
  }

  test("Checking relevance without correct tx should give proper error") {
    ledger.isTransactionRelevant("invalid_tx", hexedEncryptionSecretKey) match {
      case Left(errors) =>
        assert(errors.toList.contains(LedgerErrorResult(LedgerError.TransactionError)))
      case Right(BooleanResult(isRelevant)) =>
        fail("Should not be here!")
    }
  }

  test("Applying tx to state should succeed") {
    ledger.applyTransactionToState(validTx, localState) match {
      case Left(errors)               => failWithErrors(errors)
      case Right(StringResult(state)) => assert(state.nonEmpty)
    }
  }

  test("Applying tx without correct tx should give proper error") {
    ledger.applyTransactionToState("invalid_tx", localState) match {
      case Left(errors) =>
        assert(errors.toList.contains(LedgerErrorResult(LedgerError.TransactionError)))
      case Right(StringResult(state)) => fail("Wrong case.")
    }
  }

  test("Applying tx without correct state should give proper error") {
    ledger.applyTransactionToState(validTx, "invalid_state") match {
      case Left(errors) =>
        assert(errors.toList.contains(LedgerErrorResult(LedgerError.StateError)))
      case Right(StringResult(state)) => fail("Wrong case.")
    }
  }
}

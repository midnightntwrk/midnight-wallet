package io.iohk.midnight.wallet.jnr

import cats.data.NonEmptyList
import cats.effect.{IO, Resource}
import io.iohk.midnight.wallet.jnr.LedgerV1.*
import munit.{CatsEffectSuite, ScalaCheckSuite}

import scala.io.{Codec, Source}

@SuppressWarnings(Array("org.wartremover.warts.ToString"))
class LedgerApiDevNetSpec extends CatsEffectSuite with ScalaCheckSuite {

  override def munitIgnore: Boolean = scala.util.Properties.isMac

  private val validDevNetTx =
    "0200010000000002000100000000010000003c26450965eec09b67f6d6dc50f52c9f64e1bb99dd5b6bbea6027a2f605af55276f1a548c532ef8715ac138fa9910d31eaeddba5c20c09f4617b3ccdbc622dcf6cf28d20a6570f4ea5aee0d9099bd1f22f7db23cc1bcf46000000200f02d00002ab149da5278952d4571ecf96cc2099b66d9180f2709969337444575ebad7bc56a68e8621c95956a2326d8fa4ee31951b916c47c2f230349980c576252bffd42305aa033770efc3a4b8c5c13853c3869337b4ee7cdb486f071e35e1ac0bf9a0dbeca164fa32fffe80c0a51ca05582a56d57b3060be0decbcf7934c9b0f0c80ef67d16bc66ac9846840bd7bfd451d359fc9add3b3c423a3851a9ef5902647d86d80ea43d588f70c024192d8742783e6b3dd7aafffa86c2e82003f08580aece000a250e1e1fc3e551b7c049c346bf6403a034202c33c7a6bf6a7fe85e05e9c6e1e371212e06f0fb6992258ee165ed14aa4cb57e6e168a0a1c64888b968fe499faa2a8b9c77221c9a0b79f0a8d809dff7443fbb8f0dd83c6a5449da95c70556b80f1e05d9f7e3f907fb793bb62aa6e591d454326ab5cd3e405103ba0969bb2bf2d3081e1015c396722dc9f883f751cc7d4787b421ddb784ee21e3b9e0bee283946004f32e600c714e95b4197394e7288f58be80eb70d761b48d9c49968977cabbcfa52b6780b10f3516c599a15233a23cdd468733454ea34ae472b5fb1dbf9227d91b76bdede284d51fd9cd1e5063dcbd4b4c861327f2435e03687f6b48ec343b4e1879bc934dc64e5ae993f3118525a82a441953fdf7b37dd44bd8634adfae1cf902b89dcd5a45b7dfd0eba60567323392332aac1a9aedb74974433c3ac0ca4c68336249e63099948878f8c4c4e12723561959184be87add081b1eeb8ef5cb755e59352153e9d4af586b4c3767387a054b841508bc6e04f0d2284eb4486d59345bd9a281aa8f10d37e0e3258d381edf3a522e750900bf42cc542c782ee847fcc0765ebd70b6d25eb08aab0e7d511fb3126cca1e924478de79967b75751601364551013e4dbb8243e8d36a3199c05eb6980129d80609149cdc929da631e8e651b145d47c8c4edaf362012ed3d623fc2c97c8e7bd8dd95498aff9494fd98183858da559a3e549d5081f26b6fcab7b8444785c37bdbb368efca4d55f781af16890a1ed0baa25a065d32b8a463c66fe7ceae317349273acd203ec9c92533f99c177fad59641e32dc873e25d113ed6bb8fed25374c56d602b417d9342fce1f9981aae909599dd8f503941bc705eabf258335178eac3b255a5598f9dbadb5a2c363e6f87e48e6d93b71c6b469d4e5ee4c79bf83f41df4ff452f708bd51a06fe68f8f89cad1bfe55ca36632ec6b5873a3f68f87cf586209af4e56d34c2d9a276393983c194e7ef70586e91935b78a0aa90c539452fbdac187481144e90e4cba1a182186fe08d79a2af0f0a97280d43e778c35bb5a3190e9da4e1efb09112ddfa91a4b354c7c8ffdfc14f7d7d89c76a6cb49ac4da0ff076c73e0a73cc77e805650db8bbc330ae5050b4872f4d56b9dbdb01211d955f24f20eab44b8e55224ca746f706d350105ad7ea33cff080f09cd61bf1a34dc0ecc7ddda4ec0692a404add591a303db31659647349860d06d1abcbe68d77c5ee07c04ac6bfb3b117c7efbb6e06a4849136ce8c494f7a6332413d4a8bfda5316b93ed40ad02b522ee1f244541d94bd9558097dd77fee676afd4a98c0c3e1fedceafedecf2fb9a9e9014cef660fbd3673c9af1c112d9d2409d0547d2a7138f28fa3abd69068cd6c34c66d7b39fd49aacd5372cb3b19dd194990623855de61eaf32d8086ec070fa547dceff16cf774208266dda0f7d37240c136962de324fc29c0d03f24e35571bec01fa82e74a659e559b152c20086d259296bd6b6a20076d9db389f844fcdd152684787e3c23ea7ffef15b06a5006549de188d34950748f33093b423768700f28bdcefad78f0b8451b9a3a1b1e1f34cf45a088f05bdd4d93d48ecea94f98a0aa1d655ecd337bd4047d51b28d7edfc2b6b2ce8d8aaa579f6ec9206787f4dd924f7ae1146eccbc4c51b0a4949625744c16960aa344de70eb438a7d69a29a26d505295c876d752e37725158bd84032ee864c68a56b96f09788e0d0fd4bff4260825f5563f802fceb907258e7fa3a6360a454865a39f2c1770c632411cbe6e4daead513b0e59d49c269a90f8c15465d294aba879c10700f78bc1eb55402319b16ddc4e47aab973d904c600ca5a90a22917e92163cd1e8d8de538fe34e3183669c46c54c8df0cda405ebd7fd99c488103c2c2cfd4746dbd157a2bfcf8e5afcfb2a86ecb3b8c64d1e83e2c4960d40207f2a20363e603093498d70fffacfbd7b55fe60a40c628f74ff8a210702d482116cc7eb1e60420b70bc6ea309b92323c4cb34ab74918586d58e58b015e3f9ddb2aa3e082c679fe179b96eb0d541b9a8e34ff3b280e2f5b01062ff3ef06ec170ba624dcaf4144804e99da3504824d8c143aaa8f66f6fa36df5a66ea0327f1a2bb76fb3560e61c4487e9b51ceacc106f8ba462b63f6db1451fed067daf44d5d594f3d39817411b0b39ddd865651fba181244978358071c33274c48e4b0c143cb9ae0863d90b7e92b426836df1a1394f2e16bfbee223aaf13446144d8e4a36125250ec2480d42a434aacff2a010c3874cb652227987c3e53010cc3a8c22d0f827be5e56da8245970e593e1e11574e37e42e91b2c287b30ad0372e307a8e499fb865e37822fe8f33abc79c319488d2ee4bb68a2d066db792915fcd89924e0bad621401d4c0b00e55c58f2aa852088a10c0ab363456d076dedc0024bb6ea38fa30cd7de8130768f01bf544ef6653066e55e4cd66b43065a1a15b224f84af0a64bf7219511e6cf954df3062343dfcb1674f3a27a40608dc9945bed34540c71b40bbd4f79b842c8065e31055aa2043efb15e71367adcc36b470bcaf4fb482b2741f3baf5b65f6d3a0776a31c8af20046070a0919de4a8ef8edb6b3553859c787fff0113a5d52d0fc363c96667fbcf37ec168ae87276484ee66329707100e052f4e7948b948b20ca07782eb47560258385cc8206311cc5aa69a0fef6b29a6babd28dc073a950fb32fbf37a30976fa2a6fd4b47aa4ec8c78c37d3ba39bb52119f0c5dfd5be15fee03dd78e46930bc4e4a0e77bccf6770a9938a3f5a48df6f4acb6bc74edaf529df8ee84ea39ab3d3161fe96950432236cf8ae09aaee0404003b9b60948245a1da2c24a8ec0a4f871e652366f36addeab669d5d0eca2aa53bb2035716e183e098f3cf5be0c6716ce38551e1cc682df6b77d05d1a89058263b7e5305106800877d6811cbcd7bb4cf17dbddd2289a9feeb563c193087adbf84c3afe754d28fe6b95140ab82b41e5a187c96d8f17274ce137b70245d1213325cd69e498e2444fcccc50e5e44a6aba7169fb5113118792d3468af3a663bbb89c9109de2aa517e9b7aef8adb92035824672f641ce359a7e6a503ac8a64bf5c7e7f4e60b15da6ef9a52215baaf1777f91739934eea777b793f6d8b0e6fc6007ed92aeea4fca35833e96790a213e0e39b3dc9ffb7d010da5fc95f9c665604e8e46d7ef23f402014e184d37cfad0f2c6583a545109621432d043d9ae84438ea8e8665e3352b138b35a66652eb1c36577f8631acb99d47a37917c092a64af1d977c80cc2386a87bcc1bb40472d140fc578c8bb78f85c6323882a45a3674ddf60c50242000392d9f1bb3775017af7fe2fadd192fac5a5e146486eb4c27b90639bde924df4705a7cb78620ae7673ac62aa86be94ab45b3b4507f746833ff940865e75157545c82eb7c47d7470744acf0e2ce92b3cad69b0207fba5d0e62867ec25e3691917de4f56a2a65b6ab9397f20c8efc4562d056604a9b8bdad253e90295c01fc7244c583f00290e0fe8abd020c01779f7a8e721c77c17278cb8a1fd5db2a886de6e0e84be4660dcaee77bf90814e0d7fa14d384e8b992f6a64693d12e19a6049eb32b4a1df9789dd20068a892520a1a27f9779ebed986149459d2a86d4b099c5c9790be41e00416ae11f0ab6ca1f7d5fc12c51fae1dc3b49c412df7111049b98c36d36aa72d941e0b51dba08fedd85bf75c4c059aa6908f5f42b8dadeadf21e4859e6834e913f6f6482fe4b6a1ade4c95889f07d90bdffa9d1e0ffa1be187e9b524cb98a9e66a2fef36650729fa802f6cb7100713c4b52047d57ecbf3a2858e0c238e754303ddf27fcca7fed391d7b306ce76fb4a32606efccd8c019e67a9900ea06de9449359ea177590411979701c435cc8d6e7f09f37e6182c0df4119e6fe3ab50818082f7408d4c38912e5e3abe7e7beeaa461f3333c0d19273ac14d4787775a725b44ff183e1c39932e94e6edb5c348afab415989733c399e8906d71f6a4a8386c77dedb572b5725b4a2c49822f463a01d2e62285536b762f2fb2f7ce321df11eb8b79680696bb75fad10f9643efbb31ef714c9ce601409601873660e39c803540815ebf56c4cfb15091492d6cd94461c5e879918440926b49ee9d12924105a2db681604e9a52aa4d1e2ae5c16e08b2171765ae613c8b023338667ce759abfdada2212e7f5bc98681b7a27530dd63795ade59cabc2fa6b4536b418c7f52ab03b1631f937c94abecbe95d0e6da6c53cf9bce05c8e653da508054abc9cc9c3147094208bde0994e0dbe4c2e333fe74d99ba5f103be1cfa0be9f7289b3fbe264d4fd47f4549d5c54ff513831a66ca58919d5a96660c37cd5be9013864087eb0c9f0dde2957512132a450eb1111bbbe1268b9c2b4005055b602190271c83edbcf774b9d8e47437a81442b2d07da173b430ca01b47b775822f91a129d2c53bcb2b92696081418d23c983a19de5700d6b39e21c3867386d590d5da7b9de94ab5605ee7f5727ca63e381b75890f0c71e3f13fb2aab6cb8f06ff41eb42bf0ebfb84563e0b8f769e5ede1cf92554eaf589e239e1a456b083b919084f7e998522224a5cdba45e1f87000bc06223fed854c7a7e415ccedd003608233e5b0eec286f5b8011e93c047d7d6ff3edf9de7a807d6a5c7ed2d558a4f18b21ee3c20e94b9b933a982f0f6d94d81d821dd5cc94051170d8cd324c4de2ba74dd1f842f9cca0c0320e6f6063a860987d765e7102d4eedf2f778fb7f9dc83720350bd4b73a420970a35ce807bd17022af9c8e11c85ba8c85d38ac6e2e51edd3c1f6aab07a7900b430b53cc87d5faae910724d9b5b16c9b7ac4cbe894f1eb65c553aa13d6a502b51fddfdbec5331a93a01d88b855a994fb53657b284cd1333325bd1a7b035ef5521cc728566176d8f7b4a9a3534b498e8e385d288a95b72260b59b715db423929ad0ebea446254895ebb88047d5a3e8cd55835be4e9a8ce75f4abcbef681f913357ff442678ded0d1a4935c82a7fba0c5f36a481f9056bb7d069ef1ae4a9c8a6cd9de0645dfb0b44c6971a7a41fe2c740504bbe49f37816b76d646c7c4ea3eab37e29ed3d7d3531982ddb5c6e182a1c264723943e4130867201ecddd58a97b44a8cf994a14eb5b64bfcd0bff2dfaf2df9953e8b5bfd00093149a5ec9120dbc1330ddb545a797ecbbf315c75e4e719454f3b4d42696692f74a16c7de7e711fd6695ecc2bade7e9b20d78c939374b6629d81712a1b0b38651c6be3c93d1b80ab5c31e9da873ff740c73ea0ff025728b3f57d6c25cd24c7a3ae297da0de658c191796d70d9bc6cd1fd429c7036edd8dbb1fb4d0a878f4bfe5d740670b4fa722f7906f5a63389428ca976fcf561875b23680985c3e3ae1556382120c789bf59aadd4b06f9d3995bd680737bdb18cc0f1dd5b219faaae3f29ee7680fe8d01a58298c55de42aedc9901809fb3ab0685e91cb015fbc82b6081a820282055daf48d62b0fce47b6572357fc2dd11c045645562e8f822f17b94c5e9c47c8ffbfd2e52d2e296238176f412d1bdd6b0cd2dfa9402a9728e13145e1a24c1aa6a3c98eae4baca5750dc6fc020afbed81a1353c4d3985373446d95acfa455f7ea37192d53feeb9aaef41b39d1e95f5a15d3bdb8bd9f6805d0ccc1e3be2efff0d7eab71d3af1f575395210286988df34ee860b2135da555158352684d5f0954a7ed37a0823a32c4a9a12ffb0ccac7d23c4a503bb2a286508a0a246f0e5d720998f3ea1d2d7d95e1b39a6c32e6b5aaa941f14bdd7ddd74142d9dd0f3e21110a407d335f23a451c61696507adbf059c31c82de55fda45bd78f4756abfe3cc67eaf917f58b8bc4f3093b0d9a6546cf69425bb082fd7b99aa14ecf76e0f2b1f4480225ba3d249085ceb833fd14d9bd7bb421c6024a0ac861834824f46685ab230ad8f926baf9e75596069ed540f18c20667d2b817917295d34235454b9e0e09449cc6cf762e1b0b180a1c8d074ddee0f5f51eca79b92316d6534cd898b86915407f5b2b7ad48fa334aaf882c4e16e9c54f0a5a5ee96a2a6c4f0f78e376d4ff3712e41cbecc4ce6c6e1d79d5c58dc3afc238c7709074ff39e7219b83c526fc59c4af7faa63a278761dc0c70dadeae08eda257b0cea1109b5cc45549504ec88c85b2187e9e96367f7d461e02a83ada65ed54095c9ffb2773619e4803eaf25c038eae1e57750eb85d65ffc28442830c49f202790ec5261ec132be54c7a846290486ae956b8015cab07361467ba134b317c1b2122490eda4487fa9091429974c7aa304933bf53d8e3f93d72104e090f8475ec1756deae58b7822b5e831fdc08659d301b230f083a6d550b0d136a90c77b474a90eecccf94ddeca2d2bcb4d85566589484d06c4bad20ebdb56b82e67172b4f2f07a5e5a0f4d28eca2ff9a8b2c80c4284a3f643ed5c59cceb0058ce9af7ad6dc87bd349460ded7fda61e38a69dc6a1f80ab01edd52b6dbb60dab49891102adfcc0e825a50ba7a5d5a27b620b80a3b5ba1211000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000041413058f32840ce44a68363b237c80b33c55862227e8d3ac53eebff946ae322d275b81501fe9dab6b5b95706787bdcd98bfda5ad97358050094330b3c7d5ce90c264c483d9a8a096b37d35e095e1bd7430977b02f2a43a8416ac5b697cd5815ccbdca4140f51546ea9a04c4f2a2bd1c82b39f3efd6f18edab62ca40656cc35f22ab7962837c01aedf7789c8a34936821cf68c867b3b39147958e5b7c061bcb3e7fc42f69827e81b07f25af3ce25bdbab2b951a4e02f332cf5e2865f66630c61883bc50ff7233aa542a913681e3c93333570a85161a10435585136ec5d397720799f8f2aa4fdf50f43034d26cd5e5429732d13fa8e050f487930c1868aaa13993aaa0f17afb968f24ccf67540b008ce50f2ed7da16cb39116abbfe68b38049d749725261ab8901c3e4789c5be6649e7c03bf2137da09e4e702c57aa267d74a78458b0be2c3eb484c9eda19096327ea0873b9320e982d207e913615605368c348244b9dd0a1f1f975eb2f5eea1533a4fc68fc68140f6ed9b5f02ad6704482b1edb6b9b5e01c21e81036e8267dc84c9adb86891f013f4f18b965f4b1ea81e63d63cad276434c58b473a51f075da4f3b7f00f2da1b01f67c79f2bdd7de19a8ccb1f846e67101ee4809d2597d6f9fbe9b8c689469c806387303e4a2cb16987ca6161f1582d5ad6483836933f22966855c234c33631e44bd83b177c19c753755eb1dc86396f61b9175b1b308b11004ea34c155209c845d24d3c15e64df8d4c425d1942e13cc1c921e6ba496e8d5fbdaadb004607f0569c9e25f40d70b2e9fa9b472f42fc5ba2d6abbf2c2b611fba70b8625bcbf61adff18430860051dc17d8de94977b8e2918bf165040781b7d8c4b6e99957703522120aee2710d536b624d040206eaf80f646ad1cf52883527b67494eeb85dfb44471d7be7a92d9f83544407b8707b3d77340e1a4515214ed0ea50f34492e43fb99f22685cf5d1052d59af7d24727f0305090235f145e27e6c566e846770082e62d6655fa3a02000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008f78c1a5daf4ec953cfe9aa82038535f105d0a6f75a0efd28a7130a2d170adcba258dfb50a24bcb13f4ff157b5e09171dbac874aafd5707d4bbec893dd3756ecad95a458e5a241064fc262a510e2d3325acf08bc46c6fe55db4139be473097a9180effde73789b69e047f07bbc99f1eb683919b69f9509688dccb043a54b6429488148e3ad907283acb04a7b52a6c82f427f9df14bb4e3dd7947c188527b9e760f00c78b5a1f42253deea930b74b9d9c33b9d7fd2e8b99867a8bc2bed8bf2d997ce099c18a34f37bb7fff7802425d48accd9bdc025af547ce8cacccac88ac04e31562795c41b3ab27e69f9d11c26d0d909cc1e9dc4624c4e67d29788006cb2296e53a19730d32eb841e9f987249c3bd93f8959c2bbde723b683919b69f9509688dccb043a54b6429488148e3ad907283acb04a7b52a6c82f427f9df14bb4e3dd7947c188527b9e760f00c78b5a1f42253deea930b74b9d9c33b9d7fd2e8b99867a8bc2bed8bf2d997ce099c18a34f37bb7fff7802425d48accd9bdc025af547ce8cacccac88ac04e31562795c41b3ab27e69f9d11c26d0d909cc1e9dc4624c4e67d29788006cb2296e53a19730d32eb841e9f987249c3bd93f8959c2bbde723950348ac0b23ebe7c7ff991486cd310e0b7a9af287cf7b0f7f7aab213cddab161afd3b2cb8c17200ac43bd062879a98a1c2bdb2f97574d0a16820a80701f606bf298026f5095563874a7b4fc47e1965b8393150534fd326dd58e084c773a59eac4a9db2ffed0f8ce1793beb79ab8c707ac2dda8dc6feb793b7e8aeb469b98760dfc93b9580f950abcbd12a5360c8328d87abb83a330c1771fd79a59d424f4a4d55119207246d561500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003af753d05564d583083217994556104e55cd774b150b9cc5d78a37ae6de318e86a244fe2dc4a2a0a56401407ef700dec080c4fc0a1b26515dcd009af27963ca879cda0ffbcebd94c01a1620e14531f5a42771c0c2ddf6eb771b188101e9b516b552b7544d56d6c8ce82f93016d340d21a8d88c4ffdf941bc0cc8ee246aae2fab8751ff10b715ad0a82dad5f020d483c1b3a2c6452150bba0f013d60d06f2a136714ec907539e99020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011882b47bbd08e3134cb176f8cb71e50e13b06d155195f7ab23bbb3577032be7cf83bd0e4e5d6e4371057fe450708e92eabe2b45250f1809df2e89cd070b8009d151d03755d7546a41c4c1453d8994632f0720d97b0542bc6747d3565448ece66d602c1178a25d31e7c72492142fa21a39a8f5f6ec95af2a5e35e44281f43c35d5786fa70b1822bd0d470555e96e21d8a955432ee0f26d36e993911f522e08e3519b08cb0264d21811882b47bbd08e3134cb176f8cb71e50e13b06d155195f7ab23bbb3577032be7cf83bd0e4e5d6e4371057fe450708e92eabe2b45250f180939a8f5f6ec95af2a5e35e44281f43c35d5786fa70b1822bd0d470555e96e21d8a955432ee0f26d36e993911f522e08e3519b08cb0264d21890038f25c364cdaee92896418ef8decd9e33f5de1f6e6b39ee439b2ef493be364cea8b2ab6bd70d8d046673567acb2e4849eadf21e67612272eca7065bebc184a7b8799ec531caabd57ded7ed81aca143eb4543acbd3479897690950eda7863535c30dc10800456c5547fced0e981308f99dabb7388271b0f4ca87ab921493e390736d9f252c1cdb1dea1e7e54529b7cd3f1642560860234085cb081cb89b59424f9d318d555ca0347c1f26c3f639acdd8a17891fea71329ff7f54baa3bff9425930698028f952db10dbc30f70c974611ce029d5f36d427596b5b7894b0b0a1e1e6f1559d8c4a25a09ef9389bc2500dbf75b8d8a195346d1d5bef516142cafe67b58a1518db459ce3df1d76cf18b20928aaa19690d062b0db3953948d3ff49fc6ca21996629677d5af333244358b208a3ca1adb42e71719adfcb2fcf0aa53fafd58d406a3e5143b1c4a35b2129f401123d571d01e9063c8872af67f33409aea708de87b98880852898f74736ffbe72f6cfe2ce80b2dd28e5cf65091cae74a3b69951264c058c93075e2c912b8b73c36c7ffe675e4e97dcd6ddea9713362f6c0707afbcaa87314d6c27c6e846b178b396732d1f75366be98cd8d8c7867d062920219a971c70759bae02f8b24420de2f25776635b51103b7c85e6604f30c0ee6505e3bf99f384a9fadec9deddbb70afc168e4ff9f1a268341ee34067d83f96a38fcb11ad0f84421e24b53331f6ecdbf871995779603c4728cd2e54589e90f30cf1559dc0eadd429d3fa21137bfcd0c5220513aceb3502a651ab2bfbb04f61e0f5b75ae30f4698e3aba1ac1de02cf33299f30689ac83d21e23a2eb81a4143e9b48d9707392f2137cc224f5691399dc1ca7aead7d49e826b5261e453d7006d5a7167c0570b2a45fe07ae0bdc243b3b4c220bf6319a6946d2d7daf5fb59c6f21a3500ade0cc47e8b55fd3f05535763ab71b9b0bcaf0eeca298d96c4be83d2b108ba7455ba5dbc38e37912fcd33c236a380809773959cff1ba2009980b71053fff24a14394eb5cf7925d8882b3a06af9fcb2d5a39b275aa491baec2292c15b79620fbeac0aaa7c57a2a7b5b5ff622b5045b40b851e161a7b53231be37924546505e702b16c54b1e274ea8be311d91b7de7f65bc3191ad3b240690638bd478ae95a3fb10528d05b6df88c04affe095bc94ea22c9a4449ca083645ba0f74a3dc96a771c71bc7265f62905a1fd4b66d24d4844f366c3c9b9177b43ed0c6672ca15009821cecf41bfe6273e593437c55987d10e7c29036c63ef0c1106a0716060b0492afc1eaad67f47d67eced238559256e4884d66c3a76df36706c003dcf33cde40f227097ad2ca14069bfab87940740fc5466ec7ba9d19cfe50664cc2e5f54768ef6456f8963c0e6272928179598d9fdf6aa62254ecf2fadf23414c57a57e1607a82d2bba3ca85989d2f9cf96b3d48424fa287c99cb60a78a72d300f3005a47116ed40e5a0ab159aef9c51757042bc730414b67baa29842feada5f516d17fe8b920d9b57c3b769135a9687ef2dc124c907ba3a954136746c3c7a3a037294ea252f42206999ea4cc5d35d454d903ae09c52251df9e03607b7159eba98f105597c9e01572e58035b832b7be6b4ed5aacfc6e8a9cc763e3915d9601b2138710af0e19439ceba4e521cca1c699c898c2e4464816b89f2af8047f9204c06075cfec2e9c9fca5f30db8706915c629ed52de7c5edbca1d5c31dd1018f907b41a14bc769a4ad027b00c13fe9a6d869689f285f8c45921aa748a8cde940c32701328c7d1763f374ecd79b3db4f646920b884deb32a47e83a326e28a668db4bf514a99d62eafc785c9542f92c2e740986af67f5082c3cea60eb7da14c190232f074796b30e0085601b504ff40c53ae883376f33fcbdd10ddbd310ee34891ef84a0eb55c382c59b4d52349abd763e961e1d75753bce129bb8819ca1e3de28f5e1da7f6feeafc3216e664ba29d67531c13de8000385f96932f1eede01a8996d5823a249b83554e1e8f9e836c7b25a64e7e8a0310166eeb9c022f75ba103f5ffb0ae5b067cad0ed64c4e1718d5af074ca917f420ff27d04e3f694193a0ac34ab7ab984e996e6cc56eb3a89c6e9506d8c8e0cedbd81fef06c12e545dafb6078cc76a984fda1766a50a0483dccc120fbe03207758886925fd529502648ce6e898158c777d0d993e64c5c122e9fa9d5e6f04c4003ee6ca89dd0323f8082839b4c4e7426dbfb33154a3a404fb96c72d76253ce5df62a08363a9c9d2260e04419b64e6f056b6bb551dba39595c469e337397a9642f289d63890a0b6285601fd805c1c4943f7434151ea7d0229dbb7d8018760a151bed97c09d0a14515c0534bf546d551719fb6615c7280d7888b9e52b31d7daad5919a13bfe989b4f08ee52660f5dd89603db3c05e433ade085eaa7f251aadd41f7468d69e013f34db3d761625dc2dc01973c62eff18187f2fd695c3f2c9279a7d02a6e11cf819d29775d98c70deede29132e18cb008aa971093c5195341f23dfb70b3a991540879aa8958d585f03e54776f17a1b3e0dccaf3f990faca42023b873b05d486abc4e842dd68fab7b7abe1026c53f41b8a0066ed1518d0816078af8a4499c3374c9e72ac9b7bce9065fdc0e27b992b03b9d22ef1c30a48600bd95406654faeb29898660dca005ba7e65dbd7dd40eda0fa4d48e35244f96a74b3a39258b6aff9f4341d4adab8769fcef494cde9fbbc3d2012a6ec3cf264c385cf7930825a925e05bec4b27597f451a0eb97f09186e58f105fb4998e326cbef2aa26e9eb7144192c0d46a1510d2a3418286a524a18dd13b74cb2f0e910e1e99d4e7d636ca204e4ca5d043b089084dd4e7e212a1551cb09fc7378491f5a2ab196ba06f81406049ae3f2c12a496e5438425a4f60881e8728e366265708f2ab457687efce42055f088d4eea92b31f36158b1f0df36f92a709609d8304903fdc079dde36dbd2699666f6440eb203671874574b96d79b7d19580b075ff882d34b5844ea32d2aa08de749642411ccf54f93f9c6e5aaff98c4c730d08adaa68de322f563fde7128d9093c3ab9f8e3914da45b2c9e77749d79f8ac1e8392dcc3d7baa43d3ae92287d14651438cecd193be8af43c93414722e219aa9e68ae31a8c34a4580f7f76c74ff62126e5067eba6465248f1aabdc5469d975d1fd7f4f8749bcd409939a0e4543da095089801e37ceeff9b0dc15e1173e78a622be20c1242f603bade89a3fd01043041b01850457686f7cb431674be105cfd0155cbb8b824f8ce89c6515848081046f31aaae5a158bf5fe78962ac72734c0b4d1de231d9894270e6c4577a718020cdb6f6a74a3760aa338163664ce2a36da6cefa10c5749529fdaf4b983150f62de979fbce2ac12e96ab29e044d4a1c90568fa2ba79cde3aa763b8fe77e0c156618f000294f5b64811590843bc73c10011afea4408e2a1bf5ce5ec301654da0ebfd021f2fc8ef1776f40d1199c9c71fa062588aa3921c375f9d1435bb3f0e251edae1ee9b4900b5f482e0e791300414591b2efb9242ca022c3540ef8418b870c6067fadcccf4313e3b22f96d845966fe5eb56524f1dc62d32ab238f2e39f8884b7763438379011a14fd95954f3f762e17f28aaf403a82654fe287962dc6ac47151ea63526b16213a7f5cc5a25ee5a0c5245f20860ae1a02b416f252a039f82258edd8c67e8cea95fe2e2554cde108093e211c21f5382e22b5245ecb29aa8f51a330df0d2c5c1685acd82c1f5f1a4853bc86ff3965af62170f3f613ae290013fea327064c69375b9694b33de538dccbdcc1d29d06b2476128492e1d9da30fb494a5737e874534cac91b130bc430b220e7740e762f03b4588c11b9e538d086eff977ed0f50691ffbee47ce8d34935c9a68325d311c759ce2c9cbdf3b741a2212f7a6011bbc1d53f11c6c1a3314b35b8921c16c9ab0360d48221c9450d0041eb0cdf0329768a4b80c670032d66b5f66588e141ca5d089a7ee0b2d57fb0a27d5a098f24f18bc38e46e51bf1ce22ecfc6cba9059b1c790e21782d626f197134ba3051f922870044e3b30f6f13f2d65beb00512b866ab2d4af41d28319d10ee7d52517222d8609a3f08ae387fef3441c91bf5d04444cc23f6ae33f0a56b13780ed7b73141dafdc767118357de5a4735ba3907c802d13780cae20a9a8a3deffb0b7365580dc243280363b5592c4c13782e1f2aedf379a1a6a20529c3b5a177bd88d4a4bad9a44974545302d1ed6c8ba0db52c7726cb2967fb6dd9ed503f014d4df9491252a1c0ae5a61fecae9261b61a4c2ed36ad5ba45df1dca3ec0f9a238c821610b81c35595184115248ebb3d3436ac08a8ebb584f0fc67f3f14753808d81fbbed4e90f111c041b662e656eb154ce4b178508f2e7523a7edc0fdb79aec0fa20f2d5a297325b39eca5160713440c07cda4bea3164dafd63fa5edfe35b79ee6e969a56c267ba9f5e2dbc9b64430de9279740a60e85a0bfbac23024f5dd793400fc30e9c145decdde911a78f03c4dfb1f9a71a7096e89fc29cebeaffddd94a02de9d664f70ea92a790641b288787a501aec538262c992015c5615d54b4540af7a8ef5013afcddb7f6499624d5343fc00aaa3bc9893959dfe774fa2da5181735b3dec1077163db560c3a3bef7c05029fad2bba025a4969f0f5963c5a4854392f1cd98c226095c221efa5ed76a7911610dc73dd44a7187cdff021b10df0a86c43396e1dea25f9c4e3457f4205095655930afb6f5883e1b01ee876cde7a0e47a5b7466add397425ff99c23c34c6f81ed3f1af8303032c442bdc2c8e6310e8224e53db9169ff6301e8edc67b0866237d18c6dfa1f73de6f5e37bcd6eec9859d658f3baf9a8a06a6cfdf202ba222bb08ee99ab3e551281bf36610c49be148fae3fe01b2c7b34e209f1114708a515ecebb2b9905913903f71e087f096764f8ecba40ab30720bab3255650642e981bd91a87566b173859b4925308b964590f8d0b6a381e2be5a15f220c680af03c4c09b5dfa725d3dd4d8d60e2f171ca1232819a6aa1584969bbe887760cd56c24c97ea5b0345aff4cc96c76558d9df9444cfc00f90a3a9c2817829bbf594cf5c990b14d1befda99403a3eb71ccd0bfa2976c4c068eb499e99cda171235e6026f4ce06d3c93477369208b693358e7042a5f536da4b32aa74850c1a752c26a7bf60a664fedb6dd0b03146cf21e380810ceb63ce9960f08cab817b499476be3f316763d6dd186c737dff5e0dc79e769668af80a6a4f7440321407c9b32610e8d794c0e18c5f4ac2173f75fe921652e3a554e458a6f1774fb64a6da9b810c1bd4afb15012313caea77179b68a8fc5a4f70531ad629ea135c791c6585fdb19c1f54edd8f566b7b6beb2b2e68f883d421976f7b95195beba2bb61905e293c12447c5dc1ef308aad3e7241a18200722e76abdbc4789e61806695cd144a97e0bcdff00599908dcdd6da437d8f3bbcaa1c745abbb486b06b0896a980733eeec6ee100ae720a640fe634bc9b23dec65eeb87db628ead5c5d56898f03a3040ed398337f5ec3851b20ab85b671feef91c733a5aa1165d1b663884ac2d44116632f468e36716dcd8405c2744c6f7d5c92d2305c3c436c90d363e9dae5f76b98f49d585a3cac2279bc97a29b241817d954d952a4efcb99108a85a49eed124ba842adfd3647b33715970dc4a64c977ab019cf31f3dd2c3991ba98b87032de201a18927b3d02ebe13bc8208a3c788ad80c174a083211f3782cb1843212149c7c20c1f4bcd74c76b2e458daba72332c27dff056884f563d272ca22a8b6b7be422b5ff6ae8422cfaad0468b0cec8d91df9cbc387ed5540c426edbda2f1e9b2ff7b59c2375b41f25a53e86d08209a8b66f809186cfe005ffd75ccb1451f93bd2b0812c6c452e63903be6e759d4aed45d99b8d904f8c1b72a6da7eba3af75c598790745a9cd5832387ff7acb95d7fcaaaa7b9debdc50ce0dc5fd1b154bf563ac09399100731b1653a54df251fe33dcf58100754601cc39faf3efc48448f9917e432ccbafb87eb7495e918fef96b01a8c70974ceab0acfa8c240cd2b5fdc46832b93f408a4fb558bc181a6d86d6d2e37f723dd655b27412e6c77201850e414249a0ea1af4ea7155b4578a1f00000000010000000100010000000000000000000000000000000000000000000000000000000000000000f0d8ffffffffffffffffffffffffffff000038a0eedb7488426c2f5f6d034fdd190608aeda6ca02bbc0e303428c75df236017dbbb8bb5921d822e9b26b3beb18bbd17df9a03a4b9e574723"

  test("Extracting guaranteed coins from DEV NET transaction should work") {
    val devNetLedger =
      LedgerLoader
        .loadLedger(networkId = Some(NetworkId.DevNet), ProtocolVersion.V1)
        .getOrElse(fail("Invalid ledger state"))

    assert(devNetLedger.extractGuaranteedCoinsFromTransaction(validDevNetTx).isRight)
  }

  test("Extracting guaranteed coins from wrong network transaction should NOT work") {
    val undeployedLedger =
      LedgerLoader
        .loadLedger(networkId = Some(NetworkId.Undeployed), ProtocolVersion.V1)
        .getOrElse(fail("Invalid ledger state"))

    undeployedLedger.extractGuaranteedCoinsFromTransaction(validDevNetTx) match {
      case Left(errors) =>
        assert(
          errors.toList
            .map(_.getMessage)
            .mkString
            .contains("Ledger error code 8"),
        )
      case Right(_) => fail("Should not be here!")
    }
  }

  // FIXME: In order to get a valid state one has to run the system so this test can't be updated
  test("Contract zswap chain state can be derived from local ledger state (zswap)".ignore) {
    val devNetLedger =
      LedgerLoader
        .loadLedger(networkId = Some(NetworkId.DevNet), ProtocolVersion.V1)
        .getOrElse(fail("Invalid ledger state"))

    val testR = for {
      ledgerState <- getFileContent("ledger_state_devnet.txt")
      expectedZSwapChainState <- getFileContent("expected_zswap_chain_state.txt")
    } yield devNetLedger.zswapChainStateFilter(
      zswapChainState = ledgerState,
      contractAddress = "010001f2b1e1b25d787c9b208fb6155ffd3992a55bee88468864c7f5bc46bb2a64546e",
    ) match {
      case Left(errors)         => fail(errors.toList.map(_.getMessage).mkString(","))
      case Right(filteredState) => assertEquals(filteredState.data, expectedZSwapChainState)
    }

    testR.use_
  }

  private def getFileContent(fileName: String): Resource[IO, String] = {
    val readFileF =
      IO(Source.fromURL(getClass.getClassLoader.getResource(s"$fileName"), Codec.UTF8.name))
    Resource
      .make(readFileF)(f => IO(f.close()))
      .map(_.getLines().toSeq.mkString(System.lineSeparator()))
  }
}
